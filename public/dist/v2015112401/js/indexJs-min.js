/*! cross-framework - v0.1.2 - 2015-12-19 */var rankPanelTmp=['<div class="personContent-top clearfix">','<img class="personImg" src="#{headimg}" alt="" />','<div class="per-content">','<div class="per-content-title" clearfix">','<span class="per-name">#{nickname}</span>',"</div>",'<div class="per-hostid">#{hostId}</div>','<div class="per-icon">',"#{badge}",'<span class="hotListImg basicLevel#{lv_rich}"></span>',"#{richMark}","</div>",'<div class="per-des">#{description}</div>',"</div>","</div>",'<div class="personContent-middle clearfix">','<span class="per-info">#{sex} | #{age} | #{starname} | #{procity}</span>',"#{isLive}",'<a href="#{space_url}" target="_blank" class="personLink">TA的空间</a>',"</div>",'<div class="personContent-bottom clearfix">','<div class="per-handle">','<i class="per-fav"></i><a href="javascript:void(0)" class="per-fav-btn" data-fav="" title="点击关注"><span class="per-fav-btn-title">关注</span>（<i class="per-fav-btn-num">#{attens}</i>）</a>',"</div>",'<div class="per-handle">','<i class="per-msg"></i><a href="javascript:void(0)" class="displayWinBtn per-msg-btn">发私信</a>',"</div>",'<a href="#{room_url}/#{rid}" target="_blank" class="btn btn-red per-video-btn">进入房间</a>',"</div>"].join(""),showMsgDialog=function(){var a=$.dialog({title:"发私信给",content:['<div class="msg-reply">','<textarea class="textarea" name="" id="txtContent" rows="10"></textarea>','<div class="tool clearfix">','<span class="tool-tips">',"还能输入",'<span class="tool-num">200</span>',"字","</span>",'<button class="btn">发送</button>',"</div>","</div>"].join(""),onshow:function(){var a=this;if(!User.isLogin())return alert("请登录后再发送私信"),void a.remove();var b=a.buttonTarget.closest(".personDiv").find(".per-name").text(),c=a.buttonTarget.closest(".personDiv").data("rel"),d=$(".msg-reply"),e=$("#txtContent");e.val(""),a.setTitle("发私信给"+b),wordsCount(e,d.find(".tool-num"),200);var f;d.off("click",".btn"),d.on("click",".btn",function(){return 0==$.trim(e.val()).length?($.tips("发送内容不能为空。"),void a.remove()):(f&&4!=f.readyState&&f.abort(),void(f=$.ajax({url:"/member/domsg",data:{content:e.val(),tid:c,fid:User.UID},dataType:"json",type:"POST",success:function(b){b.ret?(a.remove(),$.tips("私信发送成功")):alert(b.info)}})))})}});$(document).on("click",".per-msg-btn",function(){a.setBtnTarget($(this)),a.show()})},favoriteHandle=function(a){var b=a.target.find(".per-fav-btn"),c=b.find("span");parseInt(a.checkatten,10)?(c.text("已关注"),b.data("fav","1")):(c.text("关注"),b.data("fav","0")),favoriteBtnSub(a)},favoriteBtnSub=function(a){var b,c=a.target.find(".per-fav-btn"),d=c.find("span"),e=c.find(".per-fav-btn-num");c.on("click",function(){var f=parseInt(c.data("fav"),10),g=1,h=parseInt(e.text(),10);return g=0==f?1:2,User.isLogin()?(b&&4!=b.readyState&&b.abort(),void(b=$.ajax({url:"/focus",type:"GET",dataType:"json",data:{pid:a.uid,ret:g},success:function(a){1==a.status?f?(d.text("关注"),c.data("fav","0"),e.text(h-1)):(d.text("已关注"),c.data("fav","1"),e.text(h+1)):3==a.status&&$.tips(a.msg)},error:function(a){}}))):void alert("请登录后再关注")})},getPanelData=function(a,b){a.find(".panel-hover").off("click"),a.on("mouseenter",".panel-hover",function(){var a=this;$(a).find(".personContent-top").length||$.ajax({type:"GET",url:"/majax/getfidinfo",data:{uid:$(a).attr("rel"),atten:!0},dataType:"json",success:function(c){if(c.ret){if(0==c.info.sex?c.info.sex="女":c.info.sex="男",3==c.info.roled?(c.info.hostId="(主播ID："+c.info.uid+")",c.info.richMark='<span class="hotListImg AnchorLevel'+c.info.lv_exp+'"></span>'):(c.info.hostId="",c.info.richMark=""),c.info.badge=0==c.info.vip?0==c.info.icon_id?"":'<span class="per-badge badge badge'+c.info.icon_id+'"></span>':'<span class="hotListImg basicLevel'+c.info.vip+'"></span>',3==Number(c.info.roled))switch(Number(c.info.live_status)){case 0:c.info.isLive="<span class='per-live per-live-nl'>休息</span>";break;case 1:c.info.isLive="<span class='per-live per-live-ol'>直播</span>";break;default:c.info.isLive=""}var d=Utility.template(rankPanelTmp,c.info);$(a).find(".personContent").html(d),3!=c.info.roled&&($(a).find(".per-video-btn").remove(),$(a).find(".personLink").remove()),$(a).find(".personLoading").remove(),c.info.target=$(a),favoriteHandle(c.info),b&&b(c)}},error:function(){window.console}})}),showMsgDialog()};Array.prototype.each=function(a){a=a||Function.K;for(var b=[],c=Array.prototype.slice.call(arguments,1),d=0;d<this.length;d++){var e=a.apply(this,[this[d],d].concat(c));null!=e&&b.push(e)}return b},Array.prototype.uniquelize=function(){for(var a=new Array,b=0;b<this.length;b++)a.contains(this[b])||a.push(this[b]);return a},Array.complement=function(a,b){return Array.minus(Array.union(a,b),Array.intersect(a,b))},Array.intersect=function(a,b){return a.uniquelize().each(function(a){return b.contains(a)?a:null})},Array.minus=function(a,b){return a.uniquelize().each(function(a){return b.contains(a)?null:a})},Array.union=function(a,b){return a.concat(b).uniquelize()},Array.prototype.contains=function(a){for(var b=0;b<this.length;b++)if(this[b]===a)return!0;return!1},function(a,b){a=function(){var a='<input type="button" class="btn btn-s" disabled value="已完成" />';this.mainTmp="",this.setMainTmp=function(a){var b=['<div class="task">','<div class="task-header">','<div class="task-header-dialog"></div>','<div class="task-header_title">挣钻石喽</div>','<div class="task-header_close">关闭</div>',"</div>",'<div class="task-content">','<div class="task-content-top"></div>','<div class="task-content-wrapper" id="J-task-content">'+a+"</div>",'<div class="task-content-bottom"></div>',"</div>","</div>"].join("");this.mainTmp=b},this.getMainTmp=function(){return $(this.mainTmp)},this.getFinishBtn=function(){return a},this.getBonusBtn=function(a){return'<button type="button" class="task-content_btn J-task-getBonus" data-id="'+a+'" >领取奖励</button>'},this.getSpecailBtn=function(a){var b={btnText:"按钮",btnUrl:"/"},c=$.extend(!0,b,a);return'<a class="task-content_btn" href="'+c.btnUrl+'">'+c.btnText+"</a>"},this.getPointsTmp=function(a){return a?'<span class="task-content_points">+'+a+'<img src="'+Config.imagePath+'/diamond.png" /></span>':""},this.getLevelTmp=function(a){return a&&"1"!=a?'<span class="hotListImg basicLevel'+a+'"></span>':""},this.getExpTimeTmp=function(a){return a&&a[0].exp?'<span class="task-content_bonus_exp">'+a[0].exp+"天</span>":""},this.getMountTmp=function(a){var b="";return b='<span class="task-content_bonus_mount">'+(a?a[0].name:"")+this.getExpTimeTmp(a)+"</span>",a?b:""},this.getIconTmp=function(a){var b="";return b='<span class="badge badge'+(a?a[0].id:"")+' task-content_bonus_icon"></span>'+this.getExpTimeTmp(a),a?b:""}},a.prototype.getTaskData=function(a){$.ajax({url:"/task",type:"GET",dataType:"json",success:function(b){a&&a(b)},error:function(a){Utility.log("get task error")}})},a.prototype.initTask=function(){var a=this;a.getTaskData(function(b){a.renderTask(b.data),a.initTaskEvent()})},a.prototype.flashTask=function(){var a=this;a.getTaskData(function(b){a.renderTask(b.data)})},a.prototype.initTaskEvent=function(){var a=this;$(".J-task-getBonus").on("click",function(b){var c=$(this),d=c.data("id");c.prop("disabled",!0),$.ajax({url:"/task/end/"+d,dataType:"json",type:"GET",success:function(b){$.tips(b.msg),c.parent().html(a.getFinishBtn()),c.prop("disabled",!1)},error:function(){Utility.log("fail to get bonus"),c.prop("disabled",!1)}})}),$(".task-header_close").on("click",function(a){a.stopPropagation(),$(".task-content").slideToggle(200),$(".task-header_close").hide()}),$(".task-header").on("click",function(){$(".task-content").is(":hidden")&&($(".task-content").slideToggle(200),$(".task-header_close").show())})},a.prototype.renderTask=function(a){var b=this,c="";for(var d in a){if($.isEmptyObject(a))return;for(var e="",f=a[d],g=0,h=f.length;h>g;g++){var i="",j="";if("all"==f[g].userStatus)i=b.getFinishBtn();else if("success"==f[g].userStatus)i=b.getBonusBtn(f[g].vtask_id);else switch(d){case"check_email":i=b.getSpecailBtn({btnText:"验证",btnUrl:"/mailverific"});break;case"invite":i=b.getSpecailBtn({btnText:"去推广",btnUrl:"/member/invite"});break;case"invite":i=b.getSpecailBtn({btnText:"立即预约",btnUrl:"/viewmore.html?tag=ord"});break;case"points":i=b.getSpecailBtn({btnText:"充值",btnUrl:"/charge/order?radioprice="+(f[g].points?f[g].points.value[0]:100)});break;case"openvip":i=b.getSpecailBtn({btnText:"首开贵族",btnUrl:"/shop?handle=noble"})}var k=b.getPointsTmp(f[g].bonus.points),l=b.getLevelTmp(f[g].bonus.top),m=b.getMountTmp(f[g].bonus.goods),n=b.getIconTmp(f[g].bonus.icon);j=k+l+m+n,e+='<li><div class="task-content_title">'+f[g].task_name+'</div><div class="task-content_info">'+j+'</div><div class="task-content_btnbox">'+i+"</div></li>"}c+='<ul class="task-item" id="task-'+d+'">'+e+"</ul>"}this.setMainTmp(c),$("body").append(this.getMainTmp()),$(".task").show()},b.Task=a}("undefined"!=typeof Task?Task:{},window);var RoomPwd=function(){var a,b=this,c=0;this.times=1,this.firstTimeApply=!0,this.init=function(){$(document).on("click",".movieList",function(){var a=$(this).data("tid"),c=$(this).data("roomid");2==a&&(b.firstTimeApply?b.roomPwdAjaxSet({data:{roomid:c},successCallback:function(a){b.times=parseInt(a.times,10),b.showPwdDialog(c),b.firstTimeApply=!1}}):b.showPwdDialog(c))})},this.setRoomId=function(a){c=a},this.getRoomId=function(){return c},this.showPwdDialog=function(a){b.times>4?tmp=['<div class="m-form">','<div class="m-form-item">','<label for="pwdRoom">房间密码：</label>','<input type="password" class="txt" id="pwdRoom" />',"</div>",'<div class="m-form-item">','<label for="pwdRoomCode">验证码：</label>','<input type="text" class="txt txt-short" id="pwdRoomCode" />','<img src="" alt="验证码" id="pwdRoomCodeImg" class="s-code-img" />','<a href="javascript:void(0);" class="change-roomcode m-form-tip J-change-scode">换一换</a>',"</div>",'<div class="m-form-item">','<span id="pwdRoomTips"></span>',"</div>","</div>"].join(""):tmp=['<div class="m-form">','<div class="m-form-item">','<label for="pwdRoom">房间密码：</label>','<input type="password" class="txt" id="pwdRoom" />',"</div>",'<div class="m-form-item">','<span id="pwdRoomTips"></span>',"</div>","</div>"].join("");var c=$.dialog({title:"密码房间",content:tmp,width:400,onshow:function(){var a=this,b=new Captcha;a.times>4&&(b.flashCaptcha($("#pwdRoomCodeImg")),$(".change-roomcode").on("click",function(){b.flashCaptcha($("#pwdRoomCodeImg"))})),$("#pwdRoom").passwordInput("#pwdRoomTips"),$("#pwdRoom, #pwdRoomCode").on("keyup",function(b){if(13==b.keyCode){if(1==$("#pwdRoomCode").length&&$("#pwdRoomCode").val().length<=0)return void $("#pwdRoomTips").text("请输入验证码。");a.ok(),a.remove()}})},ok:function(){return $("#pwdRoom").trigger("keyup"),0!=$.trim($("#pwdRoomTips").text()).length?!1:void b.roomPwdAjaxSet({data:{roomid:a,password:$("#pwdRoom").val(),captcha:$("#pwdRoomCode").val()},successCallback:function(c){1==c.code?location.href=window.V_PATH+"/"+a:($.tips(c.msg),b.times=parseInt(c.times,10))}})},okValue:"确定"});c.show()},this.roomPwdAjaxSet=function(b){var c={data:{},successCallback:function(){}},d=$.extend(!0,c,b);d.data.roomid==User.UID&&(location.href=window.V_PATH+"/"+User.UID),a&&4!=a.readyState&&a.abort(),$.ajax({url:"/checkroompwd",data:d.data,dataType:"json",type:"POST",success:function(a){d.successCallback&&d.successCallback(a)},error:function(a){$.tips("请求超时。")}})},this.init()};!function(a){a.flexslider=function(b,c){var d=a(b);d.vars=a.extend({},a.flexslider.defaults,c);var e,f=d.vars.namespace,g=window.navigator&&window.navigator.msPointerEnabled&&window.MSGesture,h=("ontouchstart"in window||g||window.DocumentTouch&&document instanceof DocumentTouch)&&d.vars.touch,i="click touchend MSPointerUp keyup",j="",k="vertical"===d.vars.direction,l=d.vars.reverse,m=d.vars.itemWidth>0,n="fade"===d.vars.animation,o=""!==d.vars.asNavFor,p={},q=!0;a.data(b,"flexslider",d),p={init:function(){d.animating=!1,d.currentSlide=parseInt(d.vars.startAt?d.vars.startAt:0,10),isNaN(d.currentSlide)&&(d.currentSlide=0),d.animatingTo=d.currentSlide,d.atEnd=0===d.currentSlide||d.currentSlide===d.last,d.containerSelector=d.vars.selector.substr(0,d.vars.selector.search(" ")),d.slides=a(d.vars.selector,d),d.container=a(d.containerSelector,d),d.count=d.slides.length,d.syncExists=a(d.vars.sync).length>0,"slide"===d.vars.animation&&(d.vars.animation="swing"),d.prop=k?"top":"marginLeft",d.args={},d.manualPause=!1,d.stopped=!1,d.started=!1,d.startTimeout=null,d.transitions=!d.vars.video&&!n&&d.vars.useCSS&&function(){var a=document.createElement("div"),b=["perspectiveProperty","WebkitPerspective","MozPerspective","OPerspective","msPerspective"];for(var c in b)if(void 0!==a.style[b[c]])return d.pfx=b[c].replace("Perspective","").toLowerCase(),d.prop="-"+d.pfx+"-transform",!0;return!1}(),d.ensureAnimationEnd="",""!==d.vars.controlsContainer&&(d.controlsContainer=a(d.vars.controlsContainer).length>0&&a(d.vars.controlsContainer)),""!==d.vars.manualControls&&(d.manualControls=a(d.vars.manualControls).length>0&&a(d.vars.manualControls)),d.vars.randomize&&(d.slides.sort(function(){return Math.round(Math.random())-.5}),d.container.empty().append(d.slides)),d.doMath(),d.setup("init"),d.vars.controlNav&&p.controlNav.setup(),d.vars.directionNav&&p.directionNav.setup(),d.vars.keyboard&&(1===a(d.containerSelector).length||d.vars.multipleKeyboard)&&a(document).bind("keyup",function(a){var b=a.keyCode;if(!d.animating&&(39===b||37===b)){var c=39===b?d.getTarget("next"):37===b?d.getTarget("prev"):!1;d.flexAnimate(c,d.vars.pauseOnAction)}}),d.vars.mousewheel&&d.bind("mousewheel",function(a,b,c,e){a.preventDefault();var f=0>b?d.getTarget("next"):d.getTarget("prev");d.flexAnimate(f,d.vars.pauseOnAction)}),d.vars.pausePlay&&p.pausePlay.setup(),d.vars.slideshow&&d.vars.pauseInvisible&&p.pauseInvisible.init(),d.vars.slideshow&&(d.vars.pauseOnHover&&d.hover(function(){d.manualPlay||d.manualPause||d.pause()},function(){d.manualPause||d.manualPlay||d.stopped||d.play()}),d.vars.pauseInvisible&&p.pauseInvisible.isHidden()||(d.vars.initDelay>0?d.startTimeout=setTimeout(d.play,d.vars.initDelay):d.play())),o&&p.asNav.setup(),h&&d.vars.touch&&p.touch(),(!n||n&&d.vars.smoothHeight)&&a(window).bind("resize orientationchange focus",p.resize),d.find("img").attr("draggable","false"),setTimeout(function(){d.vars.start(d)},200)},asNav:{setup:function(){d.asNav=!0,d.animatingTo=Math.floor(d.currentSlide/d.move),d.currentItem=d.currentSlide,d.slides.removeClass(f+"active-slide").eq(d.currentItem).addClass(f+"active-slide"),g?(b._slider=d,d.slides.each(function(){var b=this;b._gesture=new MSGesture,b._gesture.target=b,b.addEventListener("MSPointerDown",function(a){a.preventDefault(),a.currentTarget._gesture&&a.currentTarget._gesture.addPointer(a.pointerId)},!1),b.addEventListener("MSGestureTap",function(b){b.preventDefault();var c=a(this),e=c.index();a(d.vars.asNavFor).data("flexslider").animating||c.hasClass("active")||(d.direction=d.currentItem<e?"next":"prev",d.flexAnimate(e,d.vars.pauseOnAction,!1,!0,!0))})})):d.slides.on(i,function(b){b.preventDefault();var c=a(this),e=c.index(),g=c.offset().left-a(d).scrollLeft();0>=g&&c.hasClass(f+"active-slide")?d.flexAnimate(d.getTarget("prev"),!0):a(d.vars.asNavFor).data("flexslider").animating||c.hasClass(f+"active-slide")||(d.direction=d.currentItem<e?"next":"prev",d.flexAnimate(e,d.vars.pauseOnAction,!1,!0,!0))})}},controlNav:{setup:function(){d.manualControls?p.controlNav.setupManual():p.controlNav.setupPaging()},setupPaging:function(){var b,c,e="thumbnails"===d.vars.controlNav?"control-thumbs":"control-paging",g=1;if(d.controlNavScaffold=a('<ol class="'+f+"control-nav "+f+e+'"></ol>'),d.pagingCount>1)for(var h=0;h<d.pagingCount;h++){if(c=d.slides.eq(h),b="thumbnails"===d.vars.controlNav?'<img src="'+c.attr("data-thumb")+'"/>':"<a>"+g+"</a>","thumbnails"===d.vars.controlNav&&!0===d.vars.thumbCaptions){var k=c.attr("data-thumbcaption");""!=k&&void 0!=k&&(b+='<span class="'+f+'caption">'+k+"</span>")}d.controlNavScaffold.append("<li>"+b+"</li>"),g++}d.controlsContainer?a(d.controlsContainer).append(d.controlNavScaffold):d.append(d.controlNavScaffold),p.controlNav.set(),p.controlNav.active(),d.controlNavScaffold.delegate("a, img",i,function(b){if(b.preventDefault(),""===j||j===b.type){var c=a(this),e=d.controlNav.index(c);c.hasClass(f+"active")||(d.direction=e>d.currentSlide?"next":"prev",d.flexAnimate(e,d.vars.pauseOnAction))}""===j&&(j=b.type),p.setToClearWatchedEvent()})},setupManual:function(){d.controlNav=d.manualControls,p.controlNav.active(),d.controlNav.bind(i,function(b){if(b.preventDefault(),""===j||j===b.type){var c=a(this),e=d.controlNav.index(c);c.hasClass(f+"active")||(e>d.currentSlide?d.direction="next":d.direction="prev",d.flexAnimate(e,d.vars.pauseOnAction))}""===j&&(j=b.type),p.setToClearWatchedEvent()})},set:function(){var b="thumbnails"===d.vars.controlNav?"img":"a";d.controlNav=a("."+f+"control-nav li "+b,d.controlsContainer?d.controlsContainer:d)},active:function(){d.controlNav.removeClass(f+"active").eq(d.animatingTo).addClass(f+"active")},update:function(b,c){d.pagingCount>1&&"add"===b?d.controlNavScaffold.append(a("<li><a>"+d.count+"</a></li>")):1===d.pagingCount?d.controlNavScaffold.find("li").remove():d.controlNav.eq(c).closest("li").remove(),p.controlNav.set(),d.pagingCount>1&&d.pagingCount!==d.controlNav.length?d.update(c,b):p.controlNav.active()}},directionNav:{setup:function(){var b=a('<ul class="'+f+'direction-nav"><li><a class="'+f+'prev" href="#">'+d.vars.prevText+'</a></li><li><a class="'+f+'next" href="#">'+d.vars.nextText+"</a></li></ul>");d.controlsContainer?(a(d.controlsContainer).append(b),d.directionNav=a("."+f+"direction-nav li a",d.controlsContainer)):(d.append(b),d.directionNav=a("."+f+"direction-nav li a",d)),p.directionNav.update(),d.directionNav.bind(i,function(b){b.preventDefault();var c;(""===j||j===b.type)&&(c=a(this).hasClass(f+"next")?d.getTarget("next"):d.getTarget("prev"),d.flexAnimate(c,d.vars.pauseOnAction)),""===j&&(j=b.type),p.setToClearWatchedEvent()})},update:function(){var a=f+"disabled";1===d.pagingCount?d.directionNav.addClass(a).attr("tabindex","-1"):d.vars.animationLoop?d.directionNav.removeClass(a).removeAttr("tabindex"):0===d.animatingTo?d.directionNav.removeClass(a).filter("."+f+"prev").addClass(a).attr("tabindex","-1"):d.animatingTo===d.last?d.directionNav.removeClass(a).filter("."+f+"next").addClass(a).attr("tabindex","-1"):d.directionNav.removeClass(a).removeAttr("tabindex")}},pausePlay:{setup:function(){var b=a('<div class="'+f+'pauseplay"><a></a></div>');d.controlsContainer?(d.controlsContainer.append(b),d.pausePlay=a("."+f+"pauseplay a",d.controlsContainer)):(d.append(b),d.pausePlay=a("."+f+"pauseplay a",d)),p.pausePlay.update(d.vars.slideshow?f+"pause":f+"play"),d.pausePlay.bind(i,function(b){b.preventDefault(),(""===j||j===b.type)&&(a(this).hasClass(f+"pause")?(d.manualPause=!0,d.manualPlay=!1,d.pause()):(d.manualPause=!1,d.manualPlay=!0,d.play())),""===j&&(j=b.type),p.setToClearWatchedEvent()})},update:function(a){"play"===a?d.pausePlay.removeClass(f+"pause").addClass(f+"play").html(d.vars.playText):d.pausePlay.removeClass(f+"play").addClass(f+"pause").html(d.vars.pauseText)}},touch:function(){function a(a){d.animating?a.preventDefault():(window.navigator.msPointerEnabled||1===a.touches.length)&&(d.pause(),q=k?d.h:d.w,s=Number(new Date),u=a.touches[0].pageX,v=a.touches[0].pageY,p=m&&l&&d.animatingTo===d.last?0:m&&l?d.limit-(d.itemW+d.vars.itemMargin)*d.move*d.animatingTo:m&&d.currentSlide===d.last?d.limit:m?(d.itemW+d.vars.itemMargin)*d.move*d.currentSlide:l?(d.last-d.currentSlide+d.cloneOffset)*q:(d.currentSlide+d.cloneOffset)*q,j=k?v:u,o=k?u:v,b.addEventListener("touchmove",c,!1),b.addEventListener("touchend",e,!1))}function c(a){u=a.touches[0].pageX,v=a.touches[0].pageY,r=k?j-v:j-u,t=k?Math.abs(r)<Math.abs(u-o):Math.abs(r)<Math.abs(v-o);var b=500;(!t||Number(new Date)-s>b)&&(a.preventDefault(),!n&&d.transitions&&(d.vars.animationLoop||(r/=0===d.currentSlide&&0>r||d.currentSlide===d.last&&r>0?Math.abs(r)/q+2:1),d.setProps(p+r,"setTouch")))}function e(a){if(b.removeEventListener("touchmove",c,!1),d.animatingTo===d.currentSlide&&!t&&null!==r){var f=l?-r:r,g=f>0?d.getTarget("next"):d.getTarget("prev");d.canAdvance(g)&&(Number(new Date)-s<550&&Math.abs(f)>50||Math.abs(f)>q/2)?d.flexAnimate(g,d.vars.pauseOnAction):n||d.flexAnimate(d.currentSlide,d.vars.pauseOnAction,!0)}b.removeEventListener("touchend",e,!1),j=null,o=null,r=null,p=null}function f(a){a.stopPropagation(),d.animating?a.preventDefault():(d.pause(),b._gesture.addPointer(a.pointerId),w=0,q=k?d.h:d.w,s=Number(new Date),p=m&&l&&d.animatingTo===d.last?0:m&&l?d.limit-(d.itemW+d.vars.itemMargin)*d.move*d.animatingTo:m&&d.currentSlide===d.last?d.limit:m?(d.itemW+d.vars.itemMargin)*d.move*d.currentSlide:l?(d.last-d.currentSlide+d.cloneOffset)*q:(d.currentSlide+d.cloneOffset)*q)}function h(a){a.stopPropagation();var c=a.target._slider;if(c){var d=-a.translationX,e=-a.translationY;return w+=k?e:d,r=w,t=k?Math.abs(w)<Math.abs(-d):Math.abs(w)<Math.abs(-e),a.detail===a.MSGESTURE_FLAG_INERTIA?void setImmediate(function(){b._gesture.stop()}):void((!t||Number(new Date)-s>500)&&(a.preventDefault(),!n&&c.transitions&&(c.vars.animationLoop||(r=w/(0===c.currentSlide&&0>w||c.currentSlide===c.last&&w>0?Math.abs(w)/q+2:1)),c.setProps(p+r,"setTouch"))))}}function i(a){a.stopPropagation();var b=a.target._slider;if(b){if(b.animatingTo===b.currentSlide&&!t&&null!==r){var c=l?-r:r,d=c>0?b.getTarget("next"):b.getTarget("prev");b.canAdvance(d)&&(Number(new Date)-s<550&&Math.abs(c)>50||Math.abs(c)>q/2)?b.flexAnimate(d,b.vars.pauseOnAction):n||b.flexAnimate(b.currentSlide,b.vars.pauseOnAction,!0)}j=null,o=null,r=null,p=null,w=0}}var j,o,p,q,r,s,t=!1,u=0,v=0,w=0;g?(b.style.msTouchAction="none",b._gesture=new MSGesture,b._gesture.target=b,b.addEventListener("MSPointerDown",f,!1),b._slider=d,b.addEventListener("MSGestureChange",h,!1),b.addEventListener("MSGestureEnd",i,!1)):b.addEventListener("touchstart",a,!1)},resize:function(){!d.animating&&d.is(":visible")&&(m||d.doMath(),n?p.smoothHeight():m?(d.slides.width(d.computedW),d.update(d.pagingCount),d.setProps()):k?(d.viewport.height(d.h),d.setProps(d.h,"setTotal")):(d.vars.smoothHeight&&p.smoothHeight(),d.newSlides.width(d.computedW),d.setProps(d.computedW,"setTotal")))},smoothHeight:function(a){if(!k||n){var b=n?d:d.viewport;a?b.animate({height:d.slides.eq(d.animatingTo).height()},a):b.height(d.slides.eq(d.animatingTo).height())}},sync:function(b){var c=a(d.vars.sync).data("flexslider"),e=d.animatingTo;switch(b){case"animate":c.flexAnimate(e,d.vars.pauseOnAction,!1,!0);break;case"play":c.playing||c.asNav||c.play();break;case"pause":c.pause()}},uniqueID:function(b){return b.filter("[id]").add(b.find("[id]")).each(function(){var b=a(this);b.attr("id",b.attr("id")+"_clone")}),b},pauseInvisible:{visProp:null,init:function(){var a=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var b=0;b<a.length;b++)a[b]+"Hidden"in document&&(p.pauseInvisible.visProp=a[b]+"Hidden");if(p.pauseInvisible.visProp){var c=p.pauseInvisible.visProp.replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(c,function(){p.pauseInvisible.isHidden()?d.startTimeout?clearTimeout(d.startTimeout):d.pause():d.started?d.play():d.vars.initDelay>0?setTimeout(d.play,d.vars.initDelay):d.play()})}},isHidden:function(){return document[p.pauseInvisible.visProp]||!1}},setToClearWatchedEvent:function(){clearTimeout(e),e=setTimeout(function(){j=""},3e3)}},d.flexAnimate=function(b,c,e,g,i){if(d.vars.animationLoop||b===d.currentSlide||(d.direction=b>d.currentSlide?"next":"prev"),o&&1===d.pagingCount&&(d.direction=d.currentItem<b?"next":"prev"),!d.animating&&(d.canAdvance(b,i)||e)&&d.is(":visible")){if(o&&g){var j=a(d.vars.asNavFor).data("flexslider");if(d.atEnd=0===b||b===d.count-1,j.flexAnimate(b,!0,!1,!0,i),d.direction=d.currentItem<b?"next":"prev",j.direction=d.direction,Math.ceil((b+1)/d.visible)-1===d.currentSlide||0===b)return d.currentItem=b,d.slides.removeClass(f+"active-slide").eq(b).addClass(f+"active-slide"),!1;d.currentItem=b,d.slides.removeClass(f+"active-slide").eq(b).addClass(f+"active-slide"),b=Math.floor(b/d.visible)}if(d.animating=!0,d.animatingTo=b,c&&d.pause(),d.vars.before(d),d.syncExists&&!i&&p.sync("animate"),d.vars.controlNav&&p.controlNav.active(),m||d.slides.removeClass(f+"active-slide").eq(b).addClass(f+"active-slide"),d.atEnd=0===b||b===d.last,d.vars.directionNav&&p.directionNav.update(),b===d.last&&(d.vars.end(d),d.vars.animationLoop||d.pause()),n)h?(d.slides.eq(d.currentSlide).css({opacity:0,zIndex:1}),d.slides.eq(b).css({opacity:1,zIndex:2}),d.wrapup(t)):(d.slides.eq(d.currentSlide).css({zIndex:1}).animate({opacity:0},d.vars.animationSpeed,d.vars.easing),d.slides.eq(b).css({zIndex:2}).animate({opacity:1},d.vars.animationSpeed,d.vars.easing,d.wrapup));else{var q,r,s,t=k?d.slides.filter(":first").height():d.computedW;m?(q=d.vars.itemMargin,s=(d.itemW+q)*d.move*d.animatingTo,r=s>d.limit&&1!==d.visible?d.limit:s):r=0===d.currentSlide&&b===d.count-1&&d.vars.animationLoop&&"next"!==d.direction?l?(d.count+d.cloneOffset)*t:0:d.currentSlide===d.last&&0===b&&d.vars.animationLoop&&"prev"!==d.direction?l?0:(d.count+1)*t:l?(d.count-1-b+d.cloneOffset)*t:(b+d.cloneOffset)*t,d.setProps(r,"",d.vars.animationSpeed),d.transitions?(d.vars.animationLoop&&d.atEnd||(d.animating=!1,d.currentSlide=d.animatingTo),d.container.unbind("webkitTransitionEnd transitionend"),d.container.bind("webkitTransitionEnd transitionend",function(){clearTimeout(d.ensureAnimationEnd),d.wrapup(t)}),clearTimeout(d.ensureAnimationEnd),d.ensureAnimationEnd=setTimeout(function(){d.wrapup(t)},d.vars.animationSpeed+100)):d.container.animate(d.args,d.vars.animationSpeed,d.vars.easing,function(){d.wrapup(t)})}d.vars.smoothHeight&&p.smoothHeight(d.vars.animationSpeed)}},d.wrapup=function(a){n||m||(0===d.currentSlide&&d.animatingTo===d.last&&d.vars.animationLoop?d.setProps(a,"jumpEnd"):d.currentSlide===d.last&&0===d.animatingTo&&d.vars.animationLoop&&d.setProps(a,"jumpStart")),d.animating=!1,d.currentSlide=d.animatingTo,d.vars.after(d)},d.animateSlides=function(){!d.animating&&q&&d.flexAnimate(d.getTarget("next"))},d.pause=function(){clearInterval(d.animatedSlides),d.animatedSlides=null,d.playing=!1,d.vars.pausePlay&&p.pausePlay.update("play"),d.syncExists&&p.sync("pause")},d.play=function(){d.playing&&clearInterval(d.animatedSlides),d.animatedSlides=d.animatedSlides||setInterval(d.animateSlides,d.vars.slideshowSpeed),d.started=d.playing=!0,d.vars.pausePlay&&p.pausePlay.update("pause"),d.syncExists&&p.sync("play")},d.stop=function(){d.pause(),d.stopped=!0},d.canAdvance=function(a,b){var c=o?d.pagingCount-1:d.last;return b?!0:o&&d.currentItem===d.count-1&&0===a&&"prev"===d.direction?!0:o&&0===d.currentItem&&a===d.pagingCount-1&&"next"!==d.direction?!1:a!==d.currentSlide||o?d.vars.animationLoop?!0:d.atEnd&&0===d.currentSlide&&a===c&&"next"!==d.direction?!1:d.atEnd&&d.currentSlide===c&&0===a&&"next"===d.direction?!1:!0:!1},d.getTarget=function(a){return d.direction=a,"next"===a?d.currentSlide===d.last?0:d.currentSlide+1:0===d.currentSlide?d.last:d.currentSlide-1},d.setProps=function(a,b,c){var e=function(){var c=a?a:(d.itemW+d.vars.itemMargin)*d.move*d.animatingTo,e=function(){if(m)return"setTouch"===b?a:l&&d.animatingTo===d.last?0:l?d.limit-(d.itemW+d.vars.itemMargin)*d.move*d.animatingTo:d.animatingTo===d.last?d.limit:c;switch(b){case"setTotal":return l?(d.count-1-d.currentSlide+d.cloneOffset)*a:(d.currentSlide+d.cloneOffset)*a;case"setTouch":return l?a:a;case"jumpEnd":return l?a:d.count*a;case"jumpStart":return l?d.count*a:a;default:return a}}();return-1*e+"px"}();d.transitions&&(e=k?"translate3d(0,"+e+",0)":"translate3d("+e+",0,0)",c=void 0!==c?c/1e3+"s":"0s",d.container.css("-"+d.pfx+"-transition-duration",c),d.container.css("transition-duration",c)),d.args[d.prop]=e,(d.transitions||void 0===c)&&d.container.css(d.args),d.container.css("transform",e)},d.setup=function(b){if(n)d.slides.css({width:"100%","float":"left",marginRight:"-100%",position:"relative"}),"init"===b&&(h?d.slides.css({opacity:0,display:"block",webkitTransition:"opacity "+d.vars.animationSpeed/1e3+"s ease",zIndex:1}).eq(d.currentSlide).css({opacity:1,zIndex:2}):0==d.vars.fadeFirstSlide?d.slides.css({opacity:0,display:"block",zIndex:1}).eq(d.currentSlide).css({zIndex:2}).css({opacity:1}):d.slides.css({opacity:0,display:"block",zIndex:1}).eq(d.currentSlide).css({zIndex:2}).animate({opacity:1},d.vars.animationSpeed,d.vars.easing)),d.vars.smoothHeight&&p.smoothHeight();else{var c,e;"init"===b&&(d.viewport=a('<div class="'+f+'viewport"></div>').css({overflow:"hidden",position:"relative"}).appendTo(d).append(d.container),d.cloneCount=0,d.cloneOffset=0,l&&(e=a.makeArray(d.slides).reverse(),d.slides=a(e),d.container.empty().append(d.slides))),d.vars.animationLoop&&!m&&(d.cloneCount=2,d.cloneOffset=1,"init"!==b&&d.container.find(".clone").remove(),d.container.append(p.uniqueID(d.slides.first().clone().addClass("clone")).attr("aria-hidden","true")).prepend(p.uniqueID(d.slides.last().clone().addClass("clone")).attr("aria-hidden","true"))),d.newSlides=a(d.vars.selector,d),c=l?d.count-1-d.currentSlide+d.cloneOffset:d.currentSlide+d.cloneOffset,k&&!m?(d.container.height(200*(d.count+d.cloneCount)+"%").css("position","absolute").width("100%"),setTimeout(function(){d.newSlides.css({display:"block"}),d.doMath(),d.viewport.height(d.h),d.setProps(c*d.h,"init")},"init"===b?100:0)):(d.container.width(200*(d.count+d.cloneCount)+"%"),d.setProps(c*d.computedW,"init"),setTimeout(function(){d.doMath(),d.newSlides.css({width:d.computedW,"float":"left",display:"block"}),d.vars.smoothHeight&&p.smoothHeight()},"init"===b?100:0))}m||d.slides.removeClass(f+"active-slide").eq(d.currentSlide).addClass(f+"active-slide"),d.vars.init(d)},d.doMath=function(){var a=d.slides.first(),b=d.vars.itemMargin,c=d.vars.minItems,e=d.vars.maxItems;d.w=void 0===d.viewport?d.width():d.viewport.width(),d.h=a.height(),d.boxPadding=a.outerWidth()-a.width(),m?(d.itemT=d.vars.itemWidth+b,d.minW=c?c*d.itemT:d.w,d.maxW=e?e*d.itemT-b:d.w,d.itemW=d.minW>d.w?(d.w-b*(c-1))/c:d.maxW<d.w?(d.w-b*(e-1))/e:d.vars.itemWidth>d.w?d.w:d.vars.itemWidth,d.visible=Math.floor(d.w/d.itemW),d.move=d.vars.move>0&&d.vars.move<d.visible?d.vars.move:d.visible,d.pagingCount=Math.ceil((d.count-d.visible)/d.move+1),d.last=d.pagingCount-1,d.limit=1===d.pagingCount?0:d.vars.itemWidth>d.w?d.itemW*(d.count-1)+b*(d.count-1):(d.itemW+b)*d.count-d.w-b):(d.itemW=d.w,d.pagingCount=d.count,d.last=d.count-1),d.computedW=d.itemW-d.boxPadding},d.update=function(a,b){d.doMath(),m||(a<d.currentSlide?d.currentSlide+=1:a<=d.currentSlide&&0!==a&&(d.currentSlide-=1),d.animatingTo=d.currentSlide),d.vars.controlNav&&!d.manualControls&&("add"===b&&!m||d.pagingCount>d.controlNav.length?p.controlNav.update("add"):("remove"===b&&!m||d.pagingCount<d.controlNav.length)&&(m&&d.currentSlide>d.last&&(d.currentSlide-=1,d.animatingTo-=1),p.controlNav.update("remove",d.last))),d.vars.directionNav&&p.directionNav.update()},d.addSlide=function(b,c){var e=a(b);d.count+=1,d.last=d.count-1,k&&l?void 0!==c?d.slides.eq(d.count-c).after(e):d.container.prepend(e):void 0!==c?d.slides.eq(c).before(e):d.container.append(e),d.update(c,"add"),d.slides=a(d.vars.selector+":not(.clone)",d),d.setup(),d.vars.added(d)},d.removeSlide=function(b){var c=isNaN(b)?d.slides.index(a(b)):b;d.count-=1,d.last=d.count-1,isNaN(b)?a(b,d.slides).remove():k&&l?d.slides.eq(d.last).remove():d.slides.eq(b).remove(),d.doMath(),d.update(c,"remove"),d.slides=a(d.vars.selector+":not(.clone)",d),d.setup(),d.vars.removed(d)},p.init()},a(window).blur(function(a){focused=!1}).focus(function(a){focused=!0}),a.flexslider.defaults={namespace:"flex-",selector:".slides > li",animation:"fade",easing:"swing",direction:"horizontal",reverse:!1,animationLoop:!0,smoothHeight:!1,startAt:0,slideshow:!0,slideshowSpeed:7e3,animationSpeed:600,initDelay:0,randomize:!1,fadeFirstSlide:!0,thumbCaptions:!1,pauseOnAction:!0,pauseOnHover:!1,pauseInvisible:!0,useCSS:!0,touch:!0,video:!1,controlNav:!0,directionNav:!0,prevText:"Previous",nextText:"Next",
keyboard:!0,multipleKeyboard:!1,mousewheel:!1,pausePlay:!1,pauseText:"Pause",playText:"Play",controlsContainer:"",manualControls:"",sync:"",asNavFor:"",itemWidth:0,itemMargin:0,minItems:1,maxItems:0,move:0,allowOneSlide:!0,start:function(){},before:function(){},after:function(){},end:function(){},added:function(){},removed:function(){},init:function(){}},a.fn.flexslider=function(b){if(void 0===b&&(b={}),"object"==typeof b)return this.each(function(){var c=a(this),d=b.selector?b.selector:".slides > li",e=c.find(d);1===e.length&&b.allowOneSlide===!0||0===e.length?(e.fadeIn(400),b.start&&b.start(c)):void 0===c.data("flexslider")&&new a.flexslider(this,b)});var c=a(this).data("flexslider");switch(b){case"play":c.play();break;case"pause":c.pause();break;case"stop":c.stop();break;case"next":c.flexAnimate(c.getTarget("next"),!0);break;case"prev":case"previous":c.flexAnimate(c.getTarget("prev"),!0);break;default:"number"==typeof b&&c.flexAnimate(b,!0)}}}(jQuery);var hostAjax,arrayOnly=function(a,b){if(0==b.length)return!0;for(var c=0;c<b.length;c++)return a==b[c]?!1:!0},randomString=function(){var a=new Array("A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","Q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9");seedLen=a.length;var b="";for(i=0;i<4;i++)j=Math.floor(Math.random()*seedLen),b+=a[j];return b},getHostItemData=function(a){$.ajax({url:"/videolist.json?_="+(new Date).valueOf()+randomString(),dataType:"json",type:"GET",success:function(b){a&&a(b),window.console},error:function(a,b){window.console}})},getItemData=function(a){var b={url:"",data:{},failText:"data fetch fail",successCallback:function(){}};$.extend(!0,b,a),hostAjax&&4!=hostAjax.readyState&&hostAjax.abort(),hostAjax=$.ajax({type:"GET",url:b.url,data:b.data,dataType:"json",success:function(a){b.successCallback&&b.successCallback(a),window.console},error:function(){window.console}})},setHotUrl=function(a,b){var c=a+"/"+b;$(".side-hot").attr("href",c)},renderHostList=function(a){if(null==a)$("#rec").html("服务器维修中，敬请期待！");else{for(var b in a)if($.isArray(a[b])){if("rec"==b||"gen"==b||"vip"==b){var c=renderItem(a[b]);$("#"+b).html(c)}if("ord"==b){var c=renderOrdItem(a[b]);$("#"+b).html(c),bindOrd()}}$(".side-online").find(".onlinePer-num").html(a.total_users)}},bindOrd=function(){var a=$(".ordRoom");a.on("click",function(){var a=$(this),b=a.find("img").attr("src"),c=a.find(".title").text(),d=a.data("duration"),e=a.data("points"),f=a.data("starttime"),g=a.data("roomid"),h=a.data("appointstate");if("1"==h){var i="<div class='ordDialog'><img src="+b+" alt /><div class='ordDialogContent'><h4>"+c+"</h4><p>直播时长："+d+"</br>直播费用："+e+"钻</br>开播时间："+f+"</p></div></div>";$.dialog({title:"立即约会",content:i,ok:function(){reserveRoom(g)},okValue:"立即约会"}).show()}})},renderRankList=function(a){$.each(a,function(a,b){if(a.indexOf("rank_")>-1){for(var c="",d="",e=0;e<b.length&&(d=0==e?"rank-text-bold":"",5!=e);e++){var f="",g="",h=!1,i="";a.indexOf("_exp_")>0&&(h=!0),h?i="rank-text-exp":f="undefined"==typeof b[e].vip||"0"==b[e].vip.toString()?0==b[e].icon_id?"":'<div class="rank-badge badge badge'+b[e].icon_id+'"></div>':'<div class="hotListImg basicLevel'+b[e].vip+'"></div>',g=h?"AnchorLevel"+b[e].lv_exp:"basicLevel"+b[e].lv_rich,c+='<div class="rank-item panel-hover" rel="'+b[e].uid+'"><div class="rank-num rank-num-'+e+'"></div><div class="rank-text '+d+" "+i+'">'+b[e].username+"</div>"+f+'<div class="rank-mark hotListImg '+g+'"></div><div class="personDiv" data-rel="'+b[e].uid+'"><div class="arrow"></div><div class="personContent clearfix"><img class="personLoading" src="'+Config.imagePath+'/loading.gif" /></div></div></div>'}$("#"+a).html(c)}})},sliderLoad=function(a,b){for(var c=a.find("img"),d=1;d<c.length;d++)c.eq(d).attr("src",window.PIC_PATH+"/images/staticad/"+(c.eq(d).data("src")?c.eq(d).data("src"):b))},searchHandle=function(){var a=$("#searchIpt"),b=$("#searchIptBtn");b.on("click",function(){var c=a.val();b.attr("href","/search.html?nickname="+c)}),a.on("keyup",function(b){if(13==b.keyCode){var c=a.val();location.href="/search.html?nickname="+c}})};$(function(){getPanelData($(".rank-content"));var a=$("#mainSlider").find("img").eq(0);a.attr("src",window.PIC_PATH+"/images/staticad/"+(a.data("src")?a.data("src"):"default.jpg"));var b=$("#sideSlider").find("img").eq(0);if(b.attr("src",window.PIC_PATH+"/images/staticad/"+(b.data("src")?b.data("src"):"side-default.jpg")),$(".flexslider").flexslider({animation:"slide",slideshowSpeed:5e3,animationSpeed:300,initDelay:5e3}),searchHandle(),$("#index").length){var c=function(){getHostItemData(function(a){setHotUrl(window.V_PATH,a.hot_room_id),$(".side-online-num").html(a.total_users),renderHostList(a),renderRankList(a)})};c(),setInterval(function(){c()},6e4);var d=new Task;d.initTask();var e=new RoomPwd,f=getLocation("handle"),g=getLocation("rid");if(g==User.UID)return;"roompwd"==f&&g&&e.firstTimeApply&&e.roomPwdAjaxSet({data:{roomid:g},successCallback:function(a){e.times=parseInt(a.times,10),e.showPwdDialog(g),e.firstTimeApply=!1}})}else if($("#index-more").length){var h=getLocation("tag");h=""==h?"all":h;var i="all",j="<div class='m-load'></div>",k="<div class='inx-more-btn'>点击按钮，加载更多</div>",l=0,m=function(a,b,c){var d=[];if(d=3==arguments.length?b.rooms.slice(c,c+20):b.rooms,"ord"==a[0].id)var e=renderOrdItem(d);else var e=renderItem(d);a.append(e),"ord"==a[0].id&&bindOrd(),a.append(k),a.find(".m-load").remove();var f=a.find(".inx-more-btn");20==$(e).filter(".movieList").length?(f.one("click",function(){$("#"+i).append(j),m($("#"+i),b,l),$(this).remove()}),f.show()):f.remove(),l+=20},n=!0,o=function(){$("#"+i).append(j),getItemData({url:"/videolist"+i+".json",data:{_:(new Date).valueOf()+randomString()},failText:"More data fetch fail",successCallback:function(a){if(m($("#"+i),a,l),n){new RoomPwd;n=!1}}})};$(".tab-item").on("click",function(){i=$(this).data("cat"),"fav"!=i&&"res"!=i&&($("#"+i).html(""),l=0,o())}),$("#tabBtn"+h).trigger("click")}window.onload=function(){sliderLoad($("#mainSlider"),"default.jpg"),sliderLoad($("#sideSlider"),"side-default.jpg")}});