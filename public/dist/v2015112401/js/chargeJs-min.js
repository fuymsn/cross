/*! cross-framework - v0.1.2 - 2015-12-21 */$(function(){var a=function(a,b){$.ajax({url:"/charge/checkCharge",data:{orderId:a},dataType:"json",type:"GET",success:function(a){b&&b(a)},error:function(){}})},b=function(a){$.ajax({url:"/charge/del",type:"POST",data:{lid:a.id},dataType:"json",success:function(b){b.ret?($.tips(b.info),a.target.closest("tr").remove()):$.tips(b.info)},error:function(){$.tips("删除失败")}})};if($(document).on("click",".charge-del",function(){var a={};a.target=$(this),a.id=$(this).data("id"),b(a)}),$(document).on("click",".charge-unknown",function(){var b=$(this).data("tradeno"),c=$.dialog({title:"提示",content:"正在获取状态，请稍等"}).show();a(b,function(a){$.tips(a.msg),c.remove()})}),$("#chargePay").on("click",function(){var b=$(".charge-tips"),c=$("#chargeIpt").val(),d=$("input[name='charge-price']"),e=$("#chargePlat"),f=$("#chargeIptRadio");if(!d.is(":checked"))return void b.text("请选择要充值的金额");if(f.is(":checked")&&(!$.isNumeric(c)||!/^[1-9]\d*$/.test(c)||parseInt(c,10)<10||parseInt(c,10)>1e5))return void b.text("请填写正确的金额");var g=d.filter(":checked").val(),h=-1!=Number(g)?g:c,i=window.open();$.ajax({url:"/charge/pay",data:{price:h,vipLevel:e.val()},dataType:"json",type:"POST",success:function(b){if(b.status)$.tips(b.msg);else{var c=$.dialog({title:"支付状态",id:"dialogChargeState",content:"<p>充值金额："+h+"元<br/></p>",onshow:function(){$("#dialogChargeState").on("click",function(){a(b.msg.orderId)})},okValue:"已完成支付",ok:function(){var c=function(){var d=$.dialog({title:"提示",content:"正在获取状态，请稍等"}).show();a(b.msg.orderId,function(a){a.status?$.dialog({title:"提示",content:a.msg,ok:function(){return c(),!1},okValue:"再次向系统确认",cancel:function(){},cancelValue:"关闭"}).show():location.href="/member/charge",d.remove()})};c()}});c.show(),i.location.href=b.msg.gotourl}},error:function(a){}})}),$("[name='charge-price']").on("click",function(){$(".charge-tips").html("")}),getLocation("msg")&&$.tips(getLocation("msg")),getLocation("radioprice")){var c=getLocation("radioprice"),d=$("[type=radio][value="+c+"]"),e=$("#chargeIpt");d.length?d.prop("checked",!0):($("#chargeIptRadio").prop("checked",!0),e.val(c))}$("#chargeIptBox").on("click",function(){$("#chargeIpt").focus()}),$("#chargeIpt").on("click",function(){$("#chargeIptRadio").prop("checked",!0)}).on("keyup",function(){var a=0,b=$(this).val(),c=$(this).parent("span").siblings(".charge-diamond"),d=$(".charge-tips");$.isNumeric(b)&&parseInt(b,10)>1e5?(a=parseInt(b,10),c.text(10*a+"钻石"),d.text("最多充值100000元")):$.isNumeric(b)&&parseInt(b,10)<10?d.text("最少充值10元"):$.isNumeric(b)&&/^[1-9]\d*$/.test(b)&&parseInt(b,10)>=10&&parseInt(b,10)<=1e5?(a=parseInt(b,10),c.text(10*a+"钻石"),d.text("")):(c.text(""),d.text("不可输入0，小数，负数，字母和特殊符号"))})});