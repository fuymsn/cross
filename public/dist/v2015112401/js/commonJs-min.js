/*! v - v0.0.1 - 2015-12-19 */!function(a){function b(a){return h.raw?a:encodeURIComponent(a)}function c(a){return h.raw?a:decodeURIComponent(a)}function d(a){return b(h.json?JSON.stringify(a):String(a))}function e(a){0===a.indexOf('"')&&(a=a.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return a=decodeURIComponent(a.replace(g," ")),h.json?JSON.parse(a):a}catch(b){}}function f(b,c){var d=h.raw?b:e(b);return a.isFunction(c)?c(d):d}var g=/\+/g,h=a.cookie=function(e,g,i){if(void 0!==g&&!a.isFunction(g)){if(i=a.extend({},h.defaults,i),"number"==typeof i.expires){var j=i.expires,k=i.expires=new Date;k.setTime(+k+864e5*j)}return document.cookie=[b(e),"=",d(g),i.expires?"; expires="+i.expires.toUTCString():"",i.path?"; path="+i.path:"",i.domain?"; domain="+i.domain:"",i.secure?"; secure":""].join("")}for(var l=e?void 0:{},m=document.cookie?document.cookie.split("; "):[],n=0,o=m.length;o>n;n++){var p=m[n].split("="),q=c(p.shift()),r=p.join("=");if(e&&e===q){l=f(r,g);break}e||void 0===(r=f(r))||(l[q]=r)}return l};h.defaults={},a.removeCookie=function(b,c){return void 0===a.cookie(b)?!1:(a.cookie(b,"",a.extend({},c,{expires:-1})),!a.cookie(b))}}(jQuery),function(a){"function"==typeof define&&define.amd?define(["jquery"],a):a(jQuery)}(function(a){"use strict";var b=function(b){var c=b.$dialog,d=a(window),e=a(document),f=b.options.fixed,g=f?0:e.scrollLeft(),h=f?0:e.scrollTop(),i=d.width(),j=d.height(),k=c.width(),l=c.height(),m=(i-k)/2+g,n=382*(j-l)/1e3+h,o=c[0].style;o.left=Math.max(parseInt(m),g)+"px",o.top=Math.max(parseInt(n),h)+"px"},c=function(a){this.$main,this.$dialog,this.$shadow,this.$closeBtn,this.$buttonBox,this.options,this.originalOptions,this.buttonTarget,this.onshow,this.init(a)},d=0,e=['<div class="d-dialog">','<div class="d-wrapper">','<div class="d-close"></div>','<div class="d-main">','<div class="d-title">#{title}</div>','<div class="d-content">#{content}</div>','<div class="d-bottom"></div>',"</div>","</div>","</div>",'<div class="d-shadow"></div>'].join("");c.DEFAULTS={id:new Date-0+d,title:"Dialog",content:"这是Dialog",width:"auto",height:"auto",okValue:"确定",cancelValue:"取消",cancelDisplay:!0,buttonTarget:null,fixed:!0,autofocus:!0},a.extend(c.prototype,{init:function(b){this.options=this.getOptions(b),this.originalOptions=this.options;var c=Utility.template(e,this.options),f=this.options.id,g=this;this.$main=a(c),this.$closeBtn=this.$main.find(".d-close"),this.$dialog=this.$main.siblings(".d-dialog"),this.$shadow=this.$main.siblings(".d-shadow"),this.$buttonBox=this.$main.find(".d-bottom"),this.$dialog.attr("id",f),a(document).on("click",".d-close",function(a){g.remove(),a.stopPropagation()}),d++},create:function(){this.options=this.getOptions(this.originalOptions),a.isArray(this.options.button)||(this.options.button=[]),this.options.title||this.$main.find(".d-title").remove(),this.options.ok&&this.options.button.push({id:"ok",value:this.options.okValue,callback:this.options.ok,autofocus:!0}),this.options.cancel&&this.options.button.push({id:"cancel",value:this.options.cancelValue,callback:this.options.cancel,display:this.options.cancelDisplay}),this.setButton(this.options.button),this.options.button.length||this.$main.find(".d-bottom").remove()},getDefaults:function(){return c.DEFAULTS},getOptions:function(b){return a.extend(!0,{},this.getDefaults(),b)},setData:function(a){return this.data=a,this},show:function(){this.create(),a("body").append(this.$main),b(this),this.$dialog.show(),this.$shadow.show(),this.options.onshow&&(this.onshow=this.options.onshow,this.onshow());var c=this.$dialog.find("input, textarea, select").not("input[type='button']"),d=this.$dialog.find("input[type='button'], input[type='submit'], button, a");return setTimeout(function(){c.length?c[0].focus():d[0]&&d[0].focus()},0),this},close:function(){return this.$main.hide(),this},remove:function(){return this.$main.remove(),delete a.dialog.list[this.id],this.options.onremove&&this.options.onremove(),this},setButton:function(b){b=b||[];var c=this,d="",e=0;return this.callbacks={},"string"==typeof b?(d=b,e++):a.each(b,function(b,f){var g=f.id=f.id||f.value,h="";c.callbacks[g]=f.callback,f.display===!1?h=' style="display:none"':e++,d+='<button type="button" class="btn" i-id="'+g+'"'+h+(f.disabled?" disabled":"")+(f.autofocus?' autofocus class="ui-dialog-autofocus"':"")+">"+f.value+"</button>",c.$buttonBox.on("click","[i-id="+g+"]",function(b){var d=a(this);d.attr("disabled")||c._trigger(g),b.preventDefault()})}),this.$buttonBox.html(d),this},setTitle:function(a){return this.$main.find(".d-title").text(a),this},setBtnTarget:function(a){return this.buttonTarget=a,this},focus:function(){},blur:function(){},_trigger:function(a){var b=this.callbacks[a];return"function"!=typeof b||b.call(this)!==!1?this.close().remove():this}}),a.dialog=function(b){var d=c.DEFAULTS.id;return b.id&&(d=b.id),a.dialog.list[d]=new c(b)},a.dialog.list={},a.dialog.get=function(b){return void 0===b?a.dialog.list:a.dialog.list[b]},a.tips=function(b,c){var d=a.dialog({title:"提示",content:b,cancel:function(){},cancelValue:"关闭",onremove:function(){c&&c()}});d.show()}}),function(a,b){$.extend(a,{isEmail:function(a){var b=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return b.test(a)},isAccount:function(a){var b=/^[a-zA-Z0-9_\u4e00-\u9fa5]{2,8}$/;return b.test(a)},isLoginAccount:function(a){var b=/^[a-zA-Z0-9_\u4e00-\u9fa5]{6,16}$/;return b.test(a)},isPost:function(a){var b=/^[a-zA-Z0-9 ]{3,12}$/;return b.exec(a)?!0:!1},isMobile:function(a){var b=/^(13[0-9]|15[012356789]|18[0-9]|14[57]|00852)[0-9]{8}$/;return b.test(a)},isTel:function(a){var b=/^[+]{0,1}(\d){1,3}[ ]?([-]?((\d)|[ ]){1,12})+$/;return b.exec(a)?!0:!1},isQQ:function(a){return/^\d{5,11}$/.test(a)},isPhoneNum:function(a){return/^\d{5,20}$/.test(a)},isBankNum:function(a){return/^\d{6,19}$/.test(a)},isBankName:function(a){return this.isChinese(a)&&/^.{1,6}$/.test(a)},isDate:function(a){var b=/^((((1[6-9]|[2-9]\d)\d{2})-(0?[13578]|1[02])-(0?[1-9]|[12]\d|3[01]))|(((1[6-9]|[2-9]\d)\d{2})-(0?[13456789]|1[012])-(0?[1-9]|[12]\d|30))|(((1[6-9]|[2-9]\d)\d{2})-0?2-(0?[1-9]|1\d|2[0-8]))|(((1[6-9]|[2-9]\d)(0[48]|[2468][048]|[13579][26])|((16|[2468][048]|[3579][26])00))-0?2-29-))$/;return b.test(a)?!0:!1},isIdCardNo:function(a){var b=/^(\d{6})(18|19|20)?(\d{2})([01]\d)([0123]\d)(\d{3})(\d|X)?$/;return b.test(a)?!0:!1},isIP:function(a){var b=/^((2[0-4]\d|25[0-5]|[01]?\d\d?)\.){3}(2[0-4]\d|25[0-5]|[01]?\d\d?)$/;return b.test(a)?!0:!1},isPasswd:function(a){var b=/^[a-zA-Z0-9]{6,15}$/;return b.exec(a)?!0:!1},isChinese:function(a){var a=a.replace(/(^\s*)|(\s*$)/g,"");return!/^[\u4E00-\uFA29]*$/.test(a)||/^[\uE7C7-\uE7F3]*$/.test(a)?!1:!0},isChEn:function(a){var b=/^[a-zA-Z\u4E00-\u9FA5]{2,16}$/;return b.exec(a)?!0:!1},isImg:function(a){var b=new RegExp("[.]+(jpg|jpeg|png|swf|gif)$","gi");return b.test(a)?!0:!1},isInteger:function(a){return/^-?\d+$/.test(a)},isFloat:function(a){return/^(-?\d+)(\.\d+)?$/.test(a)},isPositiveInteger:function(a){return/^\d+$/.test(a)}}),b.Validation=a}("undefined"!=typeof Validation?Validation:{},window),function(a,b){$.extend(a,{log:function(a){b.console&&void 0},template:function(a,b,c){var d;if($.support.checkOn){d=[];var e,f=a.length;for(e=0;f>e;e++)d.push(a[e]);d=d.join("")}else d=a;var g=new RegExp("#{([a-z0-9_]+)}","ig");return d=d.replace(g,function(a,d,e,f){return b[d]?b[d]:c?a:""})},switchOrigin:function(a,b){return"http://"+location.host.replace(a,b)}}),b.Utility=a}("undefined"!=typeof Utility?Utility:{},window),function(a,b){"function"==typeof define&&define.amd?define(["../vendor/jquery/jquery.min.js"],b):"object"==typeof module&&module.exports?module.exports=b():this[a]=b(jQuery)}("Captcha",function(a){var b=function(){this.flashCaptcha=function(a){var b=(new Date).valueOf();a.attr("src","/verfiycode?t="+b)},this.bindChangeCaptcha=function(){var b=this;a(".J-change-scode").on("click",function(){var c=a(this).siblings(".s-code-img");b.flashCaptcha(c)})}};return b}),function(a,b){var c,d=new Captcha;a=function(){this.setRegErrorTips=function(a){$(".rTip").text(a).css("color","#c1111c")},this.setLoginErrorTips=function(a){$(".lTip").text(a).css("color","#c1111c")},this.submitR=function(a,c){var e=this,f=$("#rName"),g=$("#rNickname"),h=$("#rPassword"),i=$("#rAPassword"),j=$("#rsCodeIpt");$(a).off("click"),$(a).on("click",function(){if(0==f.val().length)return void e.setRegErrorTips("请输入登录邮箱！");if(!Validation.isEmail(f.val()))return void e.setRegErrorTips("邮箱格式不正确，且注册邮箱不能使用中文/:;\\空格，等特殊符号！");if(0==g.val().length)return void e.setRegErrorTips("请输入昵称！");if(!Validation.isAccount(g.val()))return void e.setRegErrorTips("注册昵称不能使用/:;\\空格,等特殊符号！(2-8位的昵称)");if(0==h.val().length)return void e.setRegErrorTips("请输入密码！");if(0==i.val().length)return void e.setRegErrorTips("请输入确认密码！");if(0!=h.val().length&&0!=i.val().length&&h.val()!=i.val())return void e.setRegErrorTips("两次密码输入不同！");if(0==j.val().length)return void e.setRegErrorTips("请输入验证码！");var a=$.trim(h.val()),k=$.trim(i.val());UserService.actionRegister({username:f.val(),nickname:g.val(),password:a,repassword:k,captcha:j.val(),sucCallback:function(a){b.IFRAME_LOGIN_STATE&&IFRAME_LOGIN_STATE.regSuc(),c&&c()},errCallback:function(a){e.setRegErrorTips(a.msg),d.flashCaptcha($("#rsCodeImg")),Utility.log(a.msg)}})}),$("#rsCodeIpt, #rAPassword, #rPassword, #uid, #rName").on("keydown",function(b){"13"==b.keyCode&&$(a).trigger("click")})},this.submitL=function(a){var c=this,e=$("#lName"),f=$("#lPassword"),g=$("#lsCodeIpt"),h=$("#lAuto");$(a).off("click"),$(a).on("click",function(){if(0==$.trim(e.val()).length)return void c.setLoginErrorTips("请输入登录邮箱！");if(0==$.trim(f.val()).length)return void c.setLoginErrorTips("请输入登录密码！");if(!g.is(":hidden")&&0==$.trim(g.val()).length)return void c.setLoginErrorTips("请输入验证码！");var a=$.trim(f.val());UserService.actionLogin({username:e.val(),password:a,captcha:g.val(),remember:h.prop("checked")?1:0,sucCallback:function(a){b.IFRAME_LOGIN_STATE&&IFRAME_LOGIN_STATE.loginSuc(),b.location.reload()},errCallback:function(a){c.setLoginErrorTips(a.msg),e.afterIcon(vcIconWarnTMP),f.afterIcon(vcIconWarnTMP),d.flashCaptcha($("#lsCodeImg")),a.failNums>=5&&$(".login-code").show(),Utility.log(a.msg)}})}),$("#lsCodeIpt, #lPassword, #lName").on("keydown",function(b){"13"==b.keyCode&&$(a).trigger("click")})},this.handleLoginSuccess=function(c,d){var e=c.info,f=['<div class="inx-banner-login" id="inx-banner-login">','<div class="loginImg">','<img src="#{headimg}" alt="" width="130" height="130" />',"#{userState}","</div>",'<ul class="loginAlready">','<li class="loginName clearfix">','<span class="loginNameIn">#{nickname}</span>','<span class="loginHostId">#{hostId}</span>',"</li>",'<li class="loginInfo">','<span class="loginPoints">','<span class="loginDiamond"></span>','<span class="hz">#{points}</span>',"</span>","#{badge}",'<span class="hotListImg basicLevel#{lv_rich}"></span>',"#{mark}","</li>",'<li class="buttonGrp">','<a class="buttonGrp-item" href="/member/msglist">消息 <span class="fred">#{mails}</span></a>','<span class="displayBtnGrp buttonGrp-item">','<a class="" href="/member/index">个人中心</a>',"<ul>","<li>",'<a  target="_blank" href="/member/index">基本信息</a>',"</li>","#{live}","<li>",'<a target="_blank" href="/member/attention">我的关注</a>',"</li>","<li>",'<a target="_blank" href="/member/scene">我的道具</a>',"</li>","<li>",'<a target="_blank" href="/member/consumerd">消费记录</a>',"</li>","<li>",'<a target="_blank" href="/member/password">密码管理</a>',"</li>","<li>",'<a target="_blank" href="/member/myReservation">一对一约会</a>',"</li>","<li>",'<a href="/logout">退&nbsp;&nbsp;&nbsp;&nbsp;出</a>',"</li>","</ul>","</span>",'<a href="/charge/order" class="buttonGrp-item" target="_blank">充值</a>','<a href="/about/help" class="buttonGrp-item">帮助</a>','<a href="/logout" class="buttonGrp-item bn">退出</a>',"</li>","</ul>",'<div class="loginMail"><span>您还没有完成安全邮箱验证，请<a href="/mailverific" target="_blank">立即验证</a>。</span></div>',"</div>"].join("");$("#inx-banner-login").html(""),3==e.roled?(e.hostId="(主播ID："+e.uid+")",e.live='<li><a target="_blank" href="'+b.V_PATH+"/"+e.rid+'">我要直播</a></li>',e.mark='<span class="hotListImg AnchorLevel'+e.lv_exp+'"></span>'):(e.hostId="",e.live="",e.mark="");var g=parseInt(e.mails,10);if(g?g&&99==g?e.mails="("+e.mails+"+)":e.mails="("+e.mails+")":e.mails="",e.badge=0==parseInt(e.vip,10)?0==e.icon_id?"":'<span class="loginBadge badge badge'+e.icon_id+'"></span>':'<a href="/member/vip" title="进入个人中心查看保级信息" target="_blank" class="hotListImg basicLevel'+e.vip+'"></a>',"undefined"!=typeof e.hidden){var h=parseInt(e.hidden,10)?"隐身":"在线",i=parseInt(e.hidden,10)?"dropdown-title-hidden":"dropdown-title-online";e.userState=["<div class='loginDropdown dropdown' id='loginDropdown'>","<div class='dropdown-title "+i+"'><div class='dropdown-title-text'>"+h+"</div><span class='dropdown-tri'></span></div>","<div class='dropdown-list'>","<div class='dropdown-item' id='loginOnline' data-value='0'>在线</div>","<div class='dropdown-item' id='loginHide' data-value='1'>隐身</div>","</div></div>"].join("")}var j=Utility.template(f,e);$("#headerInner").append(j),$(".headlogin").hide(),a.UID=e.uid,a.UL=parseInt(e.lv_rich,10),d&&d(c)}},$.extend(a,{UID:$.cookie("webuid"),loginDialog:$.dialog({id:"loginDialog",title:!1,content:['<div class="J-dialog-tab J-tab">','<ul class="tab-title J-tab-menu clearfix" style="list-style: none;">','<li class="tab-item active" id="dialogLogin">',"<span>用户登录</span>","</li>",'<li class="tab-item" id="dialogRegister">',"<span>用户注册</span>","</li>","</ul>",'<div class="J-tab-main active">','<div class="m-form-wrapper">','<form action="" class="lForm m-form" onSubmit="return false">','<div class="m-form-item">','<label for="lName">登录邮箱：</label>','<input type="text" class="txt" id="lName" tabIndex="1" placeholder="您的登录邮箱" />',"</div>",'<div class="m-form-item">','<label for="lPassword">登录密码：</label>','<input type="password" class="txt" id="lPassword" tabIndex="2" autocomplete="off" placeholder="您的密码"/>',"</div>",'<div class="m-form-item login-code">','<label for="lsCodeIpt">验&nbsp;&nbsp;证&nbsp;&nbsp;码：</label>','<input type="text" class="txt txt-short" id="lsCodeIpt" tabIndex="3" placeholder="不区分大小写"/>','<img src="" alt="验证码" id="lsCodeImg" class="s-code-img" />','<a href="javascript:void(0);" class="m-form-tip J-change-scode">换一换</a>',"</div>",'<div class="m-form-item clearfix">','<label for="lAuto" class="login-auto">','<input type="checkbox" id="lAuto" class="login-checkbox" />',"<span>7天免登录</span>","</label>",'<a href="/getpwd" target="_blank" class="forget-pw" title="忘记密码怎么办？点我">',"<span>忘记密码</span>",'<span class="i-vc i-vc-help"></span>',"</a>","</div>",'<div class="lTip"></div>',"</form>","</div>",'<div class="m-form-btnbox clearfix">','<button class="btn lButton btn-left" tabIndex="4">登 录</button>','<button class="btn rButtonSwitch btn-orange btn-right" tabIndex="5">注 册</button>',"</div>","</div>",'<div class="J-tab-main">','<div class="m-form-wrapper">','<form action="" class="rForm m-form" onSubmit="return false">','<div class="m-form-item">','<label for="rName">登录邮箱：</label>','<input type="text" class="txt" id="rName" tabIndex="1" placeholder="填写您的邮箱地址"/>',"</div>",'<div class="m-form-item">','<label for="rNickname">您的昵称：</label>','<input type="text" class="txt" maxlength="16" id="rNickname" tabIndex="2" placeholder="2-8位汉字、数字或字母组成"/>',"</div>",'<div class="m-form-item">','<label for="rPassword">登录密码：</label>','<input type="password" class="txt" id="rPassword" tabIndex="3" autocomplete="off" placeholder="6-22个字母和数字组成"/>',"</div>",'<div class="m-form-item">','<label for="rAPassword">确认密码：</label>','<input type="password" class="txt" id="rAPassword" tabIndex="4" autocomplete="off"/>',"</div>",'<div class="m-form-item">','<label for="rsCodeIpt">验&nbsp;&nbsp;证&nbsp;&nbsp;码：</label>','<input type="text" class="txt txt-short" id="rsCodeIpt" tabIndex="5" placeholder="不区分大小写"/>','<img src="" alt="验证码" id="rsCodeImg" class="s-code-img" />','<a href="javascript:void(0);" class="m-form-tip J-change-scode">换一换</a>',"</div>",'<span class="rTip"></span>',"</form>","</div>",'<div class="m-form-btnbox">','<button class="btn btn-register rButton" tabIndex="6">立即注册，马上去看</button>',"</div>","</div>","</div>"].join(""),onshow:function(){$("#dialogLogin, #dialogRegister").on("click",function(a){"dialogLogin"==a.currentTarget.id?d.flashCaptcha($("#lsCodeImg")):"dialogRegister"==a.currentTarget.id&&d.flashCaptcha($("#rsCodeImg"))}),$(".rButtonSwitch").on("click",function(){$("#dialogRegister").trigger("click")}),tabSwitch($(".J-dialog-tab")),d.bindChangeCaptcha(),$("#lName").accountInput(".lTip"),$("#lPassword").passwordInput(".lTip"),$("#lsCodeIpt").sCodeInput(".lTip"),$("#rName").accountInput(".rTip"),$("#rNickname").isNickname(".rTip"),$("#rPassword").passwordInput(".rTip"),$("#rsCodeIpt").sCodeInput(".rTip"),$("#rAPassword").passwordAgain("#rPassword",".rTip"),c.submitR(".rButton",function(){b.location.reload()}),c.submitL(".lButton")}}),isConnection:function(){return!!$.cookie("webuid")||!!$.cookie("v_remember_encrypt")||!!$.cookie("PHPSESSID")},isLogin:function(){return this.UID?!0:!1},handleLoginDialog:function(b,d){c=b,$(".headlogin").show(),$(".login, .register").on("click",function(b){a.showLoginDialog(),$(b.currentTarget).hasClass("login")?$("#dialogLogin").trigger("click"):$(b.currentTarget).hasClass("register")&&$("#dialogRegister").trigger("click")}),d&&d()},showLoginDialog:function(){this.loginDialog.show()},showRegDialog:function(){this.loginDialog.show(),$("#dialogRegister").trigger("click")}}),b.User=a}("undefined"!=typeof User?User:{},window),function(a,b){"function"==typeof define&&define.amd?define(["../vendor/jquery/jquery.min.js"],b):"object"==typeof module&&module.exports?module.exports=b():this[a]=b(jQuery)}("UserService",function(a){var b=function(a){var b=[],c="",d="";a=a.split("");for(var e=0,f=a.length;f>e;e++)c=a[e],d=encodeURIComponent(c),d==c&&(d=c.charCodeAt().toString(16),d=("00"+d).slice(-2)),b.push(d);return b.join("").replace(/%/g,"").toUpperCase()},c={actionLogin:function(c){a.ajax({url:"/login",type:"post",dataType:"json",data:{uname:c.username,password:b(c.password),sCode:c.captcha,v_remember:c.remember},success:function(a){1==a.status?c.sucCallback&&c.sucCallback(a):c.errCallback&&c.errCallback(a)},error:function(a){Utility.log("login server error")}})},actionRegister:function(c){a.ajax({url:"/reg",type:"post",dataType:"json",data:{username:c.username,nickname:c.nickname,password:b(c.password),repassword:b(c.repassword),sCode:c.captcha},success:function(a){1==a.status?c.sucCallback&&c.sucCallback(a):c.errCallback&&c.errCallback(a)},error:function(a){Utility.log("register server error")}})}};return c}),function(a,b){"use strict";a=function(a){var b=this,c=function(a){a.objList.show(),a.state=!0},d=function(a){a.objList.hide(),a.state=!1};this.initState={dropdown:function(){c(b)},dropup:function(){d(b)}},this.state=!1,this.handleItem,this.init=function(){this.setOptions(),this.target=$("#"+this.options.id),this.objTtile=this.target.find(".dropdown-title-text"),this.objList=this.target.find(".dropdown-list"),this.handleItem=this.options.handleItem,this.bindEvents()},this.setOptions=function(){return this.options=a},this.getOptions=function(){return this.options},this.bindEvents=function(){this.objTtile.on("click",function(){b.state?b.setState("dropup"):b.setState("dropdown")}),this.objList.on("click",".dropdown-item",function(a){var c=a.target.innerText;b.setTitle(c),b.setState("dropup"),b.handleItem(a.target)})},this.setState=function(a){this.initState[a]()},this.setTitle=function(a){this.objTtile.text(a)},this.init()},b.Dropdown=a}("undefined"!=typeof Dropdown?Dropdown:{},window),$(function(){tabSwitch(),0==$("#livePage").length&&loginInfoInit()});var tabSwitch=function(a,b){if(0==arguments.length)var a=$("body");a.find(".J-tab-menu li:not(.close)").on("click",function(){var a=$(this).closest(".J-tab");$(this).parent().children("li").removeClass("active"),$(this).addClass("active");var c=a.find(".J-tab-main");c.removeClass("active"),c.eq($(this).index()).addClass("active"),b&&b()})},timeComparing=function(a){var b=$("#"+a),c=b.find(".J-start"),d=b.find(".J-end"),e=(b.find(".btn"),c.val()),f=d.val(),g=new Date(e.replace(/-/g,"/")),h=new Date(f.replace(/-/g,"/")),i=(h.getTime()-g.getTime())/864e5;return 0>i?($.tips("请输入正确的时间起始点。"),!1):void b.submit()},wordsCount=function(a,b,c){$(a).on("keydown keyup blur mousecenter mouseleave mousemove",function(){var a=$(this).val().length||0,d=c-a;return b&&$(b).text(d>0?d:0),0>d?($(this).val($(this).val().substring(0,c)),!1):void 0})};$.fn.extend({removeVCIcon:function(){return this.each(function(){var a=$(this);a.siblings(".i-vc").remove()})},afterIcon:function(a){return this.each(function(){$(this).removeVCIcon(),$(this).after(a)})},accountInput:function(a){return this.each(function(){$(this).on("focus blur",function(b){var c=$(this),d=c.val();0==d.length&&($(a).html("请输入您的邮箱！").css({color:"#29a2ff"}),c.afterIcon(vcIconInfoTMP))}).on("keyup",function(){var b=$(this),c=$.trim(b.val());0!=c.length&&(c.length<6?($(a).html("您的邮箱地址过短！").css("color","#c1111c"),b.afterIcon(vcIconWarnTMP)):c.length>30?($(a).html("您的邮箱地址过长！").css("color","#c1111c"),b.afterIcon(vcIconWarnTMP)):Validation.isEmail(c)?".rTip"==a?$.ajax({url:"/verfiyName",type:"GET",dataType:"json",data:{type:"username",username:c},success:function(c){0==c.data?($(a).html(c.msg).css("color","#c1111c"),b.afterIcon(vcIconWarnTMP)):($(a).html(""),b.afterIcon(vcIconCorrectTMP))}}):($(a).html(""),b.afterIcon(vcIconCorrectTMP)):($(a).html("您的邮箱格式不正确！").css("color","#c1111c"),b.afterIcon(vcIconWarnTMP)))})})},isNickname:function(a){return this.each(function(){$(this).on("focus blur",function(){var b=$(this),c=b.val();0==c.length&&($(a).html("请输入昵称！").css({color:"#29a2ff"}),b.afterIcon(vcIconInfoTMP))}),$(this).on("keyup",function(){var b=$(this),c=$.trim(b.val());0!=c.length&&(Validation.isAccount(b.val())?$.ajax({url:"/verfiyName",type:"GET",dataType:"json",data:{type:"nickname",username:c},success:function(c){0==c.data?($(a).html(c.msg).css("color","#c1111c"),b.afterIcon(vcIconWarnTMP)):($(a).html("昵称格式输入正确！").css("color","#29a2ff"),b.afterIcon(vcIconCorrectTMP))}}):($(a).html("注册昵称不能使用/:;\\空格,等特殊符号！(2-8位的昵称)").css("color","#c1111c"),b.afterIcon(vcIconWarnTMP)))})})},passwordInput:function(a){return this.each(function(){var b=$(this);b.on("focus blur",function(){var c=$.trim(b.val());0==c.length&&($(a).html("请输入您的密码！").css("color","#29a2ff"),b.afterIcon(vcIconInfoTMP))}),b.on("keyup",function(){var c=b.val(),d=/^[0-9a-zA-Z]{6,22}$/;0==c.length?($(a).html("请输入您的密码！").css("color","#c1111c"),b.afterIcon(vcIconWarnTMP)):d.test(c)?($(a).html(""),b.afterIcon(vcIconCorrectTMP)):($(a).html("密码格式错误！").css("color","#c1111c"),b.afterIcon(vcIconWarnTMP))})})},sCodeInput:function(a){return this.each(function(){var b=$(this);b.on("focus blur",function(){var c=$.trim(b.val());0==c.length&&$(a).html("请输入验证码！").css("color","#29a2ff")}),b.on("keyup",function(){var b=$(this).val(),c=/^[a-zA-Z0-9]{4}$/;0==b.length?$(a).html("您的验证码不能为空！").css("color","#c1111c"):c.test(b)?$(a).html(""):$(a).html("请输入4位由数字或字母组成的验证码！").css("color","#c1111c")})})},passwordAgain:function(a,b){return this.each(function(){var c=$(this);c.on("focus blur",function(){var a=c.val();0==a.length&&($(b).html("请输入确认密码！").css("color","#29a2ff"),c.afterIcon(vcIconInfoTMP))}),c.on("keyup",function(){var d=$(a).val(),e=c.val();d===e?""==d?($(b).html("确认密码不能为空").css("color","#c1111c"),c.afterIcon(vcIconWarnTMP)):($(b).html(""),c.afterIcon(vcIconCorrectTMP)):($(b).html("两次密码输入不同").css("color","#c1111c"),c.afterIcon(vcIconWarnTMP))})})}});var vcIconCorrectTMP='<span class="i-vc i-vc-correct"></span>',vcIconWarnTMP='<span class="i-vc i-vc-warn"></span>',vcIconInfoTMP='<span class="i-vc i-vc-info"></span>',getLocation=function(a){var b=new RegExp("(^|&)"+a+"=([^&]*)(&|$)"),c=parent.location.search.substr(1).match(b);return null!=c?decodeURIComponent(c[2]):""},secMailCheck=function(){var a=$(".mail-check-close"),b=$(".mail-check-reg");a.on("click",function(){$(".mail-check-wrap").hide()}),b.on("click",function(){$(".mail-check-wrap").hide()})},renderItem=function(a){for(var b="",c=window.V_PATH+"/",d=0;d<a.length;d++){var e=a[d];if("object"==typeof e&&null!==e){if(e.live_time){if(e.live_time.indexOf("时")>-1){var f=e.live_time.indexOf("钟");f>-1&&(e.live_time=e.live_time.substring(0,f+1))}e.live_time=e.live_time.replace(/([0-9]+)/g,function(a){return"<span>"+a+"</span>"})}switch(e.lv_type?e.lv_type:e.lv_type=1,e.lv_type){case 1:e.lvType="<span class='lvtype lvtype1'></span>";break;case 2:e.lvType="<span class='lvtype lvtype2'></span>";break;case 3:e.lvType="<span class='lvtype lvtype3'></span>";break;default:e.lvType="<span class='lvtype lvtype1'></span>"}switch(1==e.enterRoomlimit?e.isLock='<span class="limit"></span>':2==e.tid?e.isLock='<span class="lock"></span>':e.isLock="",1==e.enterRoomlimit?e.isLockTips="该房间有限制":2==e.tid?e.isLockTips="该房间需要密码才能进入":e.isLockTips="",2==e.tid?e.videoPath='href="javascript:;"':e.videoPath='href="'+(c+e.rid)+'" target="_blank"',e.live_status){case 0:e.status_color="free",e.status_title="休息";break;case 1:e.status_color="live",e.status_title="直播";break;case 2:e.status_color="hot",e.status_title="热播";break;default:e.status_color="free",e.status_title="休息"}e.new_user&&8e5==e.new_user?e.isNewUser='<div class="badge badge800000"></div>':e.isNewUser="",e.headimg=/\d{13}/.test(e.headimg)?window.PIC_PATH+"/images/anchorimg/"+e.uid+"_"+e.headimg.match(/\d{13}/)[0]+".jpg":window.PIC_PATH+"/images/vzhubo.jpg",b+='<dl class="movieList" title="'+e.isLockTips+'" data-tid="'+e.tid+'" data-roomid="'+e.rid+'" data-isLimited="'+e.enterRoomlimit+'"><dt><a '+e.videoPath+' class="movieBlock"><img src="'+e.headimg+'" alt=""/><div class="status '+e.status_color+'">'+e.status_title+"</div>"+e.isNewUser+'<div class="play"></div></a></dt><dd class="title">'+e.lvType+"<a "+e.videoPath+">"+e.username+"</a>"+e.isLock+'</dd><dd class="smallTitle"><div class="time"><div class="time-ico"></div>'+("null"==e.live_time?"":e.live_time)+"</div></dl>"}}return b},renderOrdItem=function(a){for(var b="",c=window.V_PATH+"/",d="ordRoom",e=0;e<a.length;e++){var f=a[e];if(f.starttime&&f.starttime.indexOf(" ")>-1){var g=f.starttime.split(" ")[0],h=parseInt(g.split("-")[0],10)+"月"+parseInt(g.split("-")[1],10)+"日",i=f.starttime.split(" ")[1];f.sTime=h+" "+i}switch(f.lv_type){case 1:f.lvType="<span class='lvtype lvtype1'></span>";break;case 2:f.lvType="<span class='lvtype lvtype2'></span>";break;case 3:f.lvType="<span class='lvtype lvtype3'></span>";break;default:f.lvType="<span class='lvtype lvtype1'></span>"}switch(f.videoPath='href="javascript:;"',f.headimg=/\d{13}/.test(f.headimg)?window.PIC_PATH+"/images/anchorimg/"+f.uid+"_"+f.headimg.match(/\d{13}/)[0]+".jpg":window.PIC_PATH+"/images/vzhubo.jpg",0==f.new_user?f.isNewUser="":f.isNewUser='<div class="badge badge800000"></div>',Number(f.appoint_state)){case 1:f.btnReserve='<span class="btn btn-xs btn-reserve">立即预约</span>';break;case 2:f.btnReserve='<span class="btn btn-xs btn-reserve btn-disabled" >正在约会</span>';break;case 3:f.btnReserve='<span class="btn btn-xs btn-reserve btn-disabled" >已被预约</span>';break;default:f.btnReserve='<span class="btn btn-xs btn-reserve">立即预约</span>'}"undefined"!=typeof f.listType&&"myres"==f.listType&&(f.videoPath='href="'+(c+f.uid)+'" target="_blank"',f.btnReserve="<a "+f.videoPath+'><span class="btn btn-xs btn-reserve">进入房间</span></a>',d=""),b+='<dl class="movieList '+d+'" data-appointstate="'+f.appoint_state+'" data-duration="'+f.live_duration+'" data-points="'+f.points+'" data-starttime="'+f.sTime+'" data-roomid="'+f.id+'"><dt><a '+f.videoPath+' class="movieBlock"><img src="'+f.headimg+'" alt=""/><div class="play"></div>'+f.isNewUser+'</a></dt><dd class="title">'+f.lvType+"<a "+f.videoPath+">"+f.username+'</a></dd><dd class="smallTitle"><span>'+f.points+"钻 ("+f.live_duration+")</span>"+f.btnReserve+"</dd></dl>"}return b},reserveRoom=function(a){$.ajax({url:"/member/doReservation",dataType:"json",type:"GET",data:{duroomid:a,flag:!1},success:function(b){1==b.code?$.tips("预约成功"):407==b.code?$.dialog({title:"预约房间",content:"在同时间段您已经预约了其它房间，确定预约相同时间段的本房间吗？",ok:function(){$.ajax({url:"/member/doReservation",dataType:"json",type:"GET",data:{duroomid:a,flag:!0},success:function(a){1==a.code?$.tips("预约成功"):$.tips(a.msg)},error:function(a,b){$.tips("server error!")}})},okValue:"确定",cancel:function(){},cancelValue:"取消"}).show():$.tips(b.msg,function(){location.href="/?handle=reg"})},error:function(a,b){$.tips("server error!")}})},loopOptions=function(a){for(var b={startNum:0,endNum:60,interval:1,isPlusZero:!0},c=$.extend(!0,b,a),d="",e=c.startNum;e<=c.endNum;e+=c.interval)d=10>e&&c.isPlusZero?d+"<option>0"+e+"</option>":d+"<option>"+e+"</option>";return d},loginInfoInit=function(){window.user=new User;var a=function(){User.handleLoginDialog(user,function(){var a=getLocation("u");if(a){var b=document.referrer;$.cookie("invitation_uid",a,1/24),$.cookie("invitation_refer",b,1/24)}var c=getLocation("agent");c&&$.cookie("agent",c,{expires:1/48,domain:document.domain.replace(/^www/,"")});var d=getLocation("handle");"reg"==d&&$(".register").trigger("click"),"login"==d&&$(".login").trigger("click")})};User.isConnection()?$.ajax({url:"/indexinfo",type:"GET",dataType:"json",cache:!1,success:function(b){b.ret?user.handleLoginSuccess(b,function(a){if($("#index-more").length&&($("#tabBtnfav").css({display:"inline-block"}),$("#tabBtnres").css({display:"inline-block"})),$("#index").length||$("#index-more").length){var b=renderItem(a.myfav);$("#fav").html(b),a.myfav.length>0&&$("#inxFavBox").show();var b=renderOrdItem(a.myres);$("#res").html(b),a.myres.length>0&&$("#inxResBox").show()}if($("#index").length&&window.sessionStorage){var c="1"==sessionStorage.getItem("sm")?!0:!1;Validation.isEmail(a.info.safemail)||c?Validation.isEmail(a.info.safemail)||$(".loginMail").show():($(".mail-check-wrap").show(),$(".loginMail").show(),sessionStorage.setItem("sm","1"),secMailCheck())}new Dropdown({id:"loginDropdown",handleItem:function(a){$.ajax({url:"/member/hidden/"+a.dataset.value,type:"get",dataType:"json",data:"",success:function(b){if(1==b.status){Utility.log("hidden set succ");var c=parseInt(a.dataset.value),d=$("#loginDropdown").find(".dropdown-title");0==c?d.addClass("dropdown-title-online").removeClass("dropdown-title-hidden"):d.addClass("dropdown-title-hidden").removeClass("dropdown-title-online")}else Utility.log("hidden set fail")},error:function(){Utility.log("hidden set error(500)!")}})}})}):(a(),Utility.log("user login error!"));var c=b.downloadUrl;c&&(0!=c.toLowerCase().indexOf("http")&&(c=document.location.protocol+"//"+document.domain+c),$("#float-box-dl").attr("href",c))},error:function(b){a(),Utility.log("server login error!")}}):a()};